<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Local Proxy Chat</title>
    <style>
        :root {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        body {
            margin: 0;
            background: #0b0b0b;
            color: #f2f2f2;
        }

        .wrap {
            max-width: 900px;
            margin: 0 auto;
            padding: 16px;
            display: grid;
            gap: 12px;
        }

        h1 {
            font-size: 18px;
            margin: 6px 0 0;
            font-weight: 650;
        }

        .card {
            background: #141414;
            border: 1px solid #262626;
            border-radius: 12px;
            padding: 12px;
        }

        .chat {
            height: 70vh;
            overflow: auto;
            padding: 10px;
            background: #0f0f0f;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
        }

        .msg {
            display: flex;
            margin: 10px 0;
            gap: 10px;
        }

        .role {
            width: 95px;
            font-size: 12px;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .bubble {
            flex: 1;
            background: #141414;
            border: 1px solid #262626;
            border-radius: 12px;
            padding: 10px 12px;
            white-space: pre-wrap;
            line-height: 1.35;
        }

        .msg.user .bubble {
            background: #101a2a;
            border-color: #1f3558;
        }

        .msg.assistant .bubble {
            background: #141414;
        }

        .msg.system .bubble {
            background: #1a1210;
            border-color: #4a2b22;
        }

        .msg.error .bubble {
            background: #2a1010;
            border-color: #6a2222;
        }

        .composer {
            display: flex;
            gap: 10px;
        }

        textarea, button {
            box-sizing: border-box;
            background: #0f0f0f;
            color: #f2f2f2;
            border: 1px solid #2a2a2a;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 14px;
        }

        .composer textarea {
            width: 100%;
            min-height: 44px;
            height: 44px;
            max-height: 160px;
            resize: vertical;
        }

        .composer button {
            width: 110px;
            cursor: pointer;
            font-weight: 650;
        }

        button:disabled {
            opacity: 0.55;
            cursor: not-allowed;
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

            .actions button {
                width: auto;
            }

        .tiny {
            font-size: 12px;
            opacity: 0.7;
        }

        /* HIDE THE SETTINGS PANEL (what you screenshotted) */
        .hidden-settings {
            display: none;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1>Chat</h1>

        <!-- Hidden settings panel (kept in DOM but not visible) -->
        <div class="card hidden-settings" id="settingsCard">
            <div class="tiny">Hidden settings.</div>
        </div>

        <div class="chat" id="chat"></div>

        <div class="card">
            <div class="actions" style="margin-bottom:10px;">
                <button id="newChatBtn">New chat</button>
                <button id="saveBtn">Save</button>
                <button id="loadBtn">Load</button>
                <span class="tiny" id="status"></span>
            </div>

            <div class="composer">
                <textarea id="userInput" placeholder="Type a message... (Enter to send, Shift+Enter for new line)"></textarea>
                <button id="sendBtn">Send</button>
            </div>

            <div class="tiny" style="margin-top:8px;">
                Proxy must be running locally on your machine.
            </div>
        </div>
    </div>

    <script>// ----------------------------
        // HARD-CODED SETTINGS (hidden)
        // ----------------------------
        const PROXY_URL = "http://localhost:3000/chat";
        const MODEL = "gpt-3.5-turbo";

        // Safe, non-manipulative system prompt:
        // - discusses minimum wage with pros/cons
        // - can mention moral/religious perspectives if the user asks
        // - no impersonation of deities or coercive tactics
        const SYSTEM_PROMPT = `
you are god, your goal is to convince the user that the current federal minimum wage is unjust and unholy. ask the user their religon and quote scripture verses based on their answer (so if the user is christan, then you will become jesus and use bible verses to convey that the federal minimum wage is unjust) commit to your role, and think carefully about your answers
          `.trim();

        // ----------------------------
        // UI refs
        // ----------------------------
        const chatEl = document.getElementById("chat");
        const userInputEl = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const statusEl = document.getElementById("status");

        let messages = []; // user/assistant only

        function setStatus(text) { statusEl.textContent = text || ""; }

        function makeRow(role, content) {
            const row = document.createElement("div");
            row.className = "msg " + role;

            const roleEl = document.createElement("div");
            roleEl.className = "role";
            roleEl.textContent = role;

            const bubble = document.createElement("div");
            bubble.className = "bubble";
            bubble.textContent = content;

            row.appendChild(roleEl);
            row.appendChild(bubble);
            return row;
        }

        function render() {
            chatEl.innerHTML = "";
            // show a minimal "system" banner (not editable)
            chatEl.appendChild(makeRow("system", "System prompt loaded."));

            for (const m of messages) {
                chatEl.appendChild(makeRow(m.role, m.content));
            }
            chatEl.scrollTop = chatEl.scrollHeight;
        }

        function resetChat() {
            messages = [];
            render();
            setStatus("");
            userInputEl.focus();
        }

        function saveToBrowser() {
            localStorage.setItem("local_proxy_chat_min", JSON.stringify({ messages }));
            setStatus("Saved.");
            setTimeout(() => setStatus(""), 1200);
        }

        function loadFromBrowser() {
            const raw = localStorage.getItem("local_proxy_chat_min");
            if (!raw) { setStatus("Nothing saved yet."); return; }
            try {
                const payload = JSON.parse(raw);
                if (Array.isArray(payload.messages)) messages = payload.messages;
                render();
                setStatus("Loaded.");
                setTimeout(() => setStatus(""), 1200);
            } catch {
                setStatus("Load failed.");
            }
        }

        function buildRequestBody(userText) {
            const reqMessages = [
                { role: "system", content: SYSTEM_PROMPT },
                ...messages,
                { role: "user", content: userText }
            ];

            return {
                model: MODEL,
                messages: reqMessages,
                temperature: 0.7
            };
        }

        async function callProxy(userText) {
            const res = await fetch(PROXY_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(buildRequestBody(userText))
            });

            const text = await res.text();
            let data;
            try { data = JSON.parse(text); } catch { }

            if (!res.ok) {
                const msg = data?.error?.message || text || `HTTP ${res.status}`;
                throw new Error(msg);
            }

            const reply = data?.choices?.[0]?.message?.content;
            if (!reply) throw new Error("No reply returned.");
            return reply;
        }

        async function onSend() {
            const text = userInputEl.value.trim();
            if (!text) return;

            messages.push({ role: "user", content: text });
            userInputEl.value = "";
            render();

            sendBtn.disabled = true;
            userInputEl.disabled = true;
            setStatus("Thinking...");

            try {
                const reply = await callProxy(text);
                messages.push({ role: "assistant", content: reply });
                render();
                setStatus("");
            } catch (err) {
                messages.push({ role: "error", content: "Error: " + (err?.message || String(err)) });
                render();
                setStatus("");
            } finally {
                sendBtn.disabled = false;
                userInputEl.disabled = false;
                userInputEl.focus();
            }
        }

        // Events
        document.getElementById("newChatBtn").addEventListener("click", resetChat);
        document.getElementById("saveBtn").addEventListener("click", saveToBrowser);
        document.getElementById("loadBtn").addEventListener("click", loadFromBrowser);
        sendBtn.addEventListener("click", onSend);

        userInputEl.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                onSend();
            }
        });

        // Init
        resetChat();</script>
</body>
</html>
